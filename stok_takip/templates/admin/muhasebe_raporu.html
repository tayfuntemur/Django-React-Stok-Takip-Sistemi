{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Muhasebe Raporu{% endblock %}

{% block content %}
<style>
    .rapor-container { padding: 20px; background: white; border-radius: 8px; margin: 20px; }
    .rapor-baslik { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #417690; padding-bottom: 15px; }
    .rapor-baslik h1 { color: #417690; margin-bottom: 5px; }
    
    .ay-secici { text-align: center; margin-bottom: 30px; padding: 15px; background: #f0f8ff; border-radius: 8px; }
    .ay-secici select { padding: 8px 15px; margin: 0 10px; border: 2px solid #417690; border-radius: 5px; }
    .ay-secici button { padding: 8px 20px; background: #417690; color: white; border: none; border-radius: 5px; cursor: pointer; }
    
    .kasa-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
    .kasa-card h2 { margin: 0 0 10px 0; font-size: 18px; }
    .kasa-card .tutar { font-size: 36px; font-weight: bold; }
    
    .ozet-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .ozet-card { background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 5px solid #417690; }
    .ozet-card.gelir { border-left-color: #10b981; }
    .ozet-card.gider { border-left-color: #ef4444; }
    .ozet-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #666; }
    .ozet-card .tutar { font-size: 28px; font-weight: bold; }
    .ozet-card .adet { font-size: 12px; color: #999; margin-top: 5px; }
    
    .detay-tablo { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
    .detay-tablo th { background: #417690; color: white; padding: 12px; text-align: left; }
    .detay-tablo td { padding: 12px; border-bottom: 1px solid #e0e0e0; }
    
    .sonuc-card { background: #f0f8ff; padding: 25px; border-radius: 8px; border: 2px solid #417690; margin-top: 30px; }
    .sonuc-satir { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ccc; }
    .sonuc-satir.kar { font-size: 24px; font-weight: bold; color: #10b981; border: none; margin-top: 15px; }
    .sonuc-satir.zarar { font-size: 24px; font-weight: bold; color: #ef4444; border: none; margin-top: 15px; }
</style>

<div class="rapor-container">
    <div class="rapor-baslik">
        <h1>MUHASEBE RAPORU</h1>
        <p>{{ ay_adi }} {{ yil }}</p>
    </div>

    <form method="get" class="ay-secici">
        <select name="ay">
            {% for i in "123456789012"|make_list %}
                <option value="{{ forloop.counter }}" {% if forloop.counter == ay %}selected{% endif %}>
                    {{ forloop.counter }}. Ay
                </option>
            {% endfor %}
        </select>
        <select name="yil">
            <option value="2024" {% if yil == 2024 %}selected{% endif %}>2024</option>
            <option value="2025" {% if yil == 2025 %}selected{% endif %}>2025</option>
            <option value="2026" {% if yil == 2026 %}selected{% endif %}>2026</option>
        </select>
        <button type="submit">Göster</button>
    </form>

    <div class="kasa-card">
        <h2>Güncel Kasa Bakiyesi</h2>
        <div class="tutar">{{ kasa_bakiye|floatformat:2 }} TL</div>
    </div>

    <div class="ozet-grid">
        <div class="ozet-card gelir">
            <h3>Gelirler</h3>
            <div class="tutar">{{ satis_toplam|floatformat:2 }} TL</div>
            <div class="adet">{{ satis_adet }} satış</div>
        </div>

        <div class="ozet-card gider">
            <h3>Alış Giderleri</h3>
            <div class="tutar">{{ alis_toplam|floatformat:2 }} TL</div>
            <div class="adet">{{ alis_adet }} fiş</div>
        </div>

        <div class="ozet-card gider">
            <h3>Diğer Giderler</h3>
            <div class="tutar">{{ odeme_toplam|floatformat:2 }} TL</div>
        </div>
    </div>

    {% if odeme_detay %}
    <h3>Ödeme Detayları</h3>
    <table class="detay-tablo">
        <thead>
            <tr>
                <th>Ödeme Tipi</th>
                <th>Tutar</th>
            </tr>
        </thead>
        <tbody>
            {% for odeme in odeme_detay %}
            <tr>
                <td>{{ odeme.tip }}</td>
                <td>{{ odeme.tutar|floatformat:2 }} TL</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <div class="sonuc-card">
        <div class="sonuc-satir">
            <span>Toplam Gelir:</span>
            <strong>{{ satis_toplam|floatformat:2 }} TL</strong>
        </div>
        <div class="sonuc-satir">
            <span>Toplam Gider:</span>
            <strong>{{ toplam_gider|floatformat:2 }} TL</strong>
        </div>
        <div class="sonuc-satir {% if net_kar >= 0 %}kar{% else %}zarar{% endif %}">
            <span>Net Kar/Zarar:</span>
            <strong>{{ net_kar|floatformat:2 }} TL</strong>
        </div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <button onclick="window.print()" class="button">Yazdır</button>
    </div>
</div>
{% endblock %}